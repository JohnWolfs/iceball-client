var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},AnimationManager=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),t.getOrCreate=function(t,e,i,s,o){void 0===e&&(e=138),void 0===i&&(i=134),void 0===s&&(s=65),void 0===o&&(o=62);var n=Pool.getItemByCreateFun("animation",function(){return new Animation});n.clear(),n.loadAtlas(Assets.Json[t],null,t),n.index=0,n.zOrder=DisplayOrder.BulletBoom,n.interval=16,n.size(e,i);n.getGraphicBounds();return n.pivot(s,o),n},t}(),config={gameWidth:480,gameHeight:800,socketServer:"ws://106.75.145.140:3100"},BaseBall=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vx",{get:function(){return this._vx},set:function(t){this._vx=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vy",{get:function(){return this._vy},set:function(t){this._vy=t},enumerable:!0,configurable:!0}),e}(laya.display.Sprite),BallAttr={width:74,height:74,imgWidth:90,imgHeight:90,velocity:6,weight:2.2},Ball=function(t){function e(e){t.call(this),this._friction=.01,this._roDirection=0,this._status=1,this._animTime=0,this._fallPosList=[],this.graphics.loadImage(Assets.Img.ball),this.pivot(BallAttr.imgWidth/2,BallAttr.imgHeight/2),this.size(BallAttr.width,BallAttr.height),this.zOrder=DisplayOrder.Ball,this.posCenter(),this._direction=e,this._radius=BallAttr.width/2,this.initVelocity(),this._weight=BallAttr.weight}return __extends(e,t),Object.defineProperty(e.prototype,"roDirection",{get:function(){return this._roDirection},set:function(t){this._roDirection=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(t){this._weight=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction",{set:function(t){this._direction=t},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(!this.actionInStatus()){if(this.x=Utils.floatN(this.x+this._vx),this.y=Utils.floatN(this.y+this._vy),0!==this._roDirection){var t=Utils.floatN(2*Math.sqrt(Math.pow(this._vx,2)+Math.pow(this._vy,2)));this.rotation=this.rotation+(this._roDirection<0?-1:1)*t}this._nextX=this.x+this._vx,this._nextY=this.y+this._vy,(this._nextX<BallAttr.width/2||this._nextX>config.gameWidth-BallAttr.width/2)&&(this.x=this._nextX<BallAttr.width/2?BallAttr.width/2:config.gameWidth-BallAttr.width/2,this._vx*=-1,SoundManager.playSound(Assets.Sound.hit_002));var e=this._nextY<-50?"mine":"your";if(this._nextY<-50||this._nextY>config.gameHeight+50){this.vx=0,this.vy=0;Game.Instance.status=0,Bullet.boomAllBullets();for(var i=0,s=Main.Instance.gamePage._childs;i<s.length;i++){var o=s[i];o.className&&"Bullet"===o.className&&Main.Instance.gamePage.removeChild(o)}Game.Instance.timer.clearTaskList(),this._nextY<-50?(ScoreManager.Instance.mballs++,Socket.Instance.ballIn(),SoundManager.playSound(Assets.Sound.mscore)):(ScoreManager.Instance.yballs++,SoundManager.playSound(Assets.Sound.yscore)),ScoreManager.Instance.checkBalls(e),this._animTime=0,this._status=3}var n=Utils.floatN(Math.abs(this._friction*this.vx/BallAttr.velocity)),a=Utils.floatN(Math.abs(this._friction*this.vy/BallAttr.velocity));this._vx=Math.abs(this._vx)<.1?0:Utils.floatN(this._vx>0?this._vx-n:this._vx+n),this._vy=Math.abs(this._vy)<.1?0:Utils.floatN(this._vy>0?this._vy-a:this._vy+a)}},e.prototype.compRDirection=function(t,e,i,s){var o=Utils.posToLine(this.x,this.y,t,e,i,s);i<=0&&s<=0||i<0&&s>=0?(o>0&&(this.roDirection=1),o<0&&(this.roDirection=-1)):(i>0&&s<0||i>=0&&s>0)&&(o>0&&(this.roDirection=-1),o<0&&(this.roDirection=1)),global.syn&&(this.roDirection*=-1)},e.prototype.initVelocity=function(){this._vx=Utils.floatN(BallAttr.velocity*Math.round(Math.sin(90*Math.PI/180))*(0===this._direction?-1:1)),this._vy=Utils.floatN(-1*BallAttr.velocity*Math.round(Math.cos(90*Math.PI/180)))},e.prototype.posCenter=function(){this.pos(config.gameWidth/2,config.gameHeight/2)},e.prototype.actionInStatus=function(){if(3===this._status)return this._animTime+=1,this._animTime>30&&this.fallDown(),!0;if(2===this._status){var t=Ease.bounceOut(this._animTime,5,-4,1e3);if(this._animTime+=16,this.scale(t,t),this._fallPosList.push(t),this._fallPosList.length>3&&this._fallPosList.shift(),this._fallPosList[1]<this._fallPosList[0]&&this._fallPosList[1]<this._fallPosList[2]&&SoundManager.playSound(Assets.Sound.hit_002),this._animTime>1e3){var e=Game.Instance.getBallDirection();this.scale(1,1),this._status=1,this._roDirection=0,this._direction=Game.Instance.ballDirectionFactor?e:1-e,this.initVelocity(),Game.Instance.status=1,Game.Instance.toolTagContainer.unlock(),this._fallPosList=[]}return!0}return!1},e.prototype.fallDown=function(){this._animTime=0,this.posCenter(),this._status=2,this.weight=BallAttr.weight,this.removeChildren()},e.prototype.isNormalStatus=function(){return 1===this._status},e.prototype.getFrozen=function(){var t=this,e=new Sprite;e.loadImage(Assets.Img.ball_effect_ice),e.pivot(41,41),e.x=45,e.y=45,this.removeChildren(),this.addChild(e),this.weight=8,global.syn?(this.vx=Utils.floatN(this.vx/this.weight),this.vy=Utils.floatN(this.vy/this.weight)):(this.vx=Utils.floatN(this.vx*-1/this.weight),this.vy=Utils.floatN(this.vy*-1/this.weight),this.vx*=-1,this.vy*=-1),Game.Instance.timer.clearTaskByName("frozen"),Game.Instance.timer.setTimeout(function(){t.weight=BallAttr.weight,t.removeChildren()},300,this,"frozen")},e.prototype.release=function(){this.weight=BallAttr.weight,this.removeChildren()},e}(BaseBall),Bullet=function(t){function e(){t.call(this),this.className="Bullet",this.zOrder=DisplayOrder.Bullet}return __extends(e,t),e.getOrCreate=function(t,i,s,o){var n=Pool.getItemByCreateFun(s,function(){switch(s){case"StandardBullet":if("self"===o)return new StandardBullet;if("opponent"===o)return new StandardBullet;case"IceBullet":return new IceBullet;case"DivisionBullet":return new DivisionBullet;case"DivisionChildBullet":return new DivisionChildBullet;case"SmokeBullet":return new SmokeBullet;case"BombBullet":return new BombBullet;default:return console.log("not exist bullet type."),new StandardBullet}});return n.init(t,i,o),"self"===o?e.myBullets.push(n):"opponent"===o&&e.yourBullets.push(n),n},e.prototype.init=function(t,e,i){},e.prototype.update=function(){this.collision(),this.x=Utils.floatN(this.x+this._vx),this.y=Utils.floatN(this.y+this._vy),this._nextX=this.x+this._vx,this._nextY=this.y+this._vy,(this._nextX<this.width/2||this._nextX>config.gameWidth-this.width/2)&&(this.x=this._nextX<this.width/2?this.width/2:config.gameWidth-this.width/2,this._vx*=-1),(this.y<-1*this.width/2||this.y>config.gameHeight+this.height/2)&&this.release()},e.prototype.collision=function(){var t,i=Game.Instance.ball;if("self"===this._owner&&0===global.syn){t=e.yourBullets;for(var s=0,o=t;s<o.length;s++){var n=o[s];this.collisionBullets(this,n)}}else if("opponent"===this._owner&&1===global.syn){t=e.myBullets;for(var a=0,r=t;a<r.length;a++){var n=r[a];this.collisionBullets(this,n)}}this.collisionBall(i)},e.prototype.collisionBullets=function(t,e){var i=!global.syn,s={x:t.x+t.vx,y:t.y+t.vy,radius:t.radius},o={x:e.x+e.vx,y:e.y+e.vy,radius:e.radius};Utils.isCircleCollision(s,o)&&(n=Utils.fixCollision(Utils.p(t.x,t.y),Utils.p(e.x,e.y),t.radius,e.radius,i),t.x=n[0],t.y=n[1],e.x=n[2],e.y=n[3],a=Utils.compBallRebound(Utils.p(t.x,t.y),Utils.p(e.x,e.y),{vx:t.vx,vy:t.vy},{vx:e.vx,vy:e.vy},i),t.vx=a[0],t.vy=a[1],e.vx=a[2],e.vy=a[3]);var n,a},e.prototype.collisionBall=function(t){var e={x:this.x+this.vx,y:this.y+this.vy,radius:this.radius},i={x:t.x+t.vx,y:t.y+t.vy,radius:t.radius};Utils.isCircleCollision(e,i)&&this.calculateBallPhysics(t)},e.prototype.calculateBallPhysics=function(t){this.fixBallPosition(t),t.compRDirection(this.x,this.y,this.vx,this.vy),this.calculateBallVelocity(t)},e.prototype.fixBallPosition=function(t){var e=!global.syn;i=Utils.fixCollision(Utils.p(this.x,this.y),Utils.p(t.x,t.y),this.radius,t.radius,e),this.x=i[0],this.y=i[1],t.x=i[2],t.y=i[3];var i},e.prototype.calculateBallVelocity=function(t){var e=!global.syn;i=Utils.compBallRebound(Utils.p(this.x,this.y),Utils.p(t.x,t.y),{vx:this.vx,vy:this.vy},{vx:t.vx,vy:t.vy},e),this.vx=i[0],this.vy=i[1],t.vx=i[2],t.vy=i[3],this.simulateWeight(t);var i},e.prototype.simulateWeight=function(t){global.syn?(t.vx=Utils.floatN(t.vx/t.weight),t.vy=Utils.floatN(t.vy/t.weight)):(t.vx=Utils.floatN(t.vx*-1/t.weight),t.vy=Utils.floatN(t.vy*-1/t.weight),t.vx*=-1,t.vy*=-1)},e.boomAllBullets=function(){for(;e.myBullets.length>0;)e.myBullets[0].releaseAction();for(;e.yourBullets.length>0;)e.yourBullets[0].releaseAction()},e.prototype.releaseAction=function(){this.release()},e.prototype.release=function(){this.removeFromArr(),this.removeSelf(),Pool.recover(this._type,this)},e.prototype.removeFromArr=function(){var t;"self"===this._owner?(t=e.myBullets,t.splice(t.indexOf(this),1)):"opponent"===this._owner&&(t=e.yourBullets,t.splice(t.indexOf(this),1))},e.myBullets=[],e.yourBullets=[],e}(BaseBall),StandardBulletAttr={width:40,height:40,imgWidth:39,imgHeight:39,velocity:20},StandardBullet=function(t){function e(){t.call(this),this._type="standard",this.pivot(StandardBulletAttr.imgWidth/2,StandardBulletAttr.imgHeight/2),this.size(StandardBulletAttr.width,StandardBulletAttr.height),this._radius=StandardBulletAttr.width/2}return __extends(e,t),e.prototype.init=function(t,e,i){var s=Utils.floatN(StandardBulletAttr.velocity-12*(1-e));this.loadImage("self"===i?Assets.Img.bulletm:"opponent"===i?Assets.Img.bullety:""),this._owner=i,this._vx=Utils.floatN(s*Math.sin(t*Math.PI/180)),this._vy=Utils.floatN(-1*s*Math.cos(t*Math.PI/180))},e.prototype.fixBallPosition=function(t){var e=!global.syn;i=Utils.fixCollision(Utils.p(this.x,this.y),Utils.p(t.x,t.y),this.radius,t.radius,e),this.x=i[0],this.y=i[1],t.x=i[2],t.y=i[3],Utils.distanceToLine(t.x,t.y,this.x,this.y,this.vx,this.vy)<38?("self"===this._owner&&t.isNormalStatus()&&Socket.Instance.causeExplosion(),this.releaseAction(),SoundManager.playSound(Assets.Sound.boom_001,1)):SoundManager.playSound(Assets.Sound.hit_001,1);var i},e.prototype.releaseAction=function(){var t=Utils.p(this.x,this.y),e="self"===this._owner?"blue_boom":"opponent"===this._owner?"red_boom":"",i=AnimationManager.getOrCreate(e),s=Main.Instance.gamePage;i.pos(t.x,t.y),i.off(LayaEvent.COMPLETE,i,function(){}),i.on(LayaEvent.COMPLETE,i,function(){Pool.recover(e,i),i.removeSelf()}),s.addChild(i),i.play(0,!1,e),this.release()},e}(Bullet),IceBulletAttr={width:40,height:40,imgWidth:39,imgHeight:39,velocity:20},IceBullet=function(t){function e(){t.call(this),this._type="ice",this.pivot(IceBulletAttr.imgWidth/2,IceBulletAttr.imgHeight/2),this.size(IceBulletAttr.width,IceBulletAttr.height),this._radius=IceBulletAttr.width/2}return __extends(e,t),e.prototype.init=function(t,e,i){var s=Utils.floatN(IceBulletAttr.velocity-12*(1-e));this.loadImage(Assets.Img.bullet_ice),this._owner=i,this._vx=Utils.floatN(s*Math.sin(t*Math.PI/180)),this._vy=Utils.floatN(-1*s*Math.cos(t*Math.PI/180))},e.prototype.calculateBallPhysics=function(t){var e=!global.syn;i=Utils.fixCollision(Utils.p(this.x,this.y),Utils.p(t.x,t.y),this.radius,t.radius,e),this.x=i[0],this.y=i[1],t.x=i[2],t.y=i[3];Utils.distanceToLine(t.x,t.y,this.x,this.y,this.vx,this.vy);t.compRDirection(this.x,this.y,this.vx,this.vy),s=Utils.compBallRebound(Utils.p(this.x,this.y),Utils.p(t.x,t.y),{vx:this.vx,vy:this.vy},{vx:t.vx,vy:t.vy},e),this.vx=s[0],this.vy=s[1],t.vx=s[2],t.vy=s[3],this.simulateWeight(t),this.releaseAction(),this.frozen(t),"self"===this._owner&&t.isNormalStatus()&&Socket.Instance.causeExplosion();var i,s},e.prototype.frozen=function(t){t.getFrozen(),SoundManager.playSound(Assets.Sound.frozen)},e.prototype.releaseAction=function(){var t=Utils.p(this.x,this.y),e="blue_boom",i=AnimationManager.getOrCreate(e),s=Main.Instance.gamePage;i.pos(t.x,t.y),i.off(LayaEvent.COMPLETE,i,function(){}),i.on(LayaEvent.COMPLETE,i,function(){Pool.recover(e,i),i.removeSelf()}),s.addChild(i),i.play(0,!1,e),this.release()},e}(Bullet),DivisionBulletAttr={width:40,height:40,imgWidth:39,imgHeight:39,velocity:20},DivisionBullet=function(t){function e(){t.call(this),this._type="division",this.pivot(DivisionBulletAttr.imgWidth/2,DivisionBulletAttr.imgHeight/2),this.size(DivisionBulletAttr.width,DivisionBulletAttr.height),this._radius=DivisionBulletAttr.width/2}return __extends(e,t),e.prototype.init=function(t,e,i){var s=this,o=Utils.floatN(DivisionBulletAttr.velocity-12*(1-e));this.loadImage(Assets.Img.bullet_division),this._owner=i,this._vx=Utils.floatN(o*Math.sin(t*Math.PI/180)),this._vy=Utils.floatN(-1*o*Math.cos(t*Math.PI/180)),Game.Instance.timer.setTimeout(function(){s.divideEffect(),s.divide()},10,this)},e.prototype.divide=function(){for(var t=Main.Instance.gamePage,e=Utils.floatN(180*Math.atan(this.vx/this.vy)/Math.PI*-1),i=0;i<3;i++){var s=Bullet.getOrCreate(Utils.floatN(e+20*(i-1)+("opponent"===this._owner?180:0)),.6,"DivisionChildBullet",this._owner);s.pos(this.x,this.y),t.addChild(s)}SoundManager.playSound(Assets.Sound.boom_003)},e.prototype.divideEffect=function(){var t=Utils.p(this.x,this.y),e="green_boom",i=AnimationManager.getOrCreate(e),s=Main.Instance.gamePage;i.pos(t.x,t.y),i.off(LayaEvent.COMPLETE,i,function(){}),i.on(LayaEvent.COMPLETE,i,function(){Pool.recover(e,i),i.removeSelf()}),s.addChild(i),i.play(0,!1,e),this.release()},e}(Bullet),DivisionChildBullet=function(t){function e(){t.call(this),this._type="divisionchild",this.pivot(DivisionBulletAttr.imgWidth/2,DivisionBulletAttr.imgHeight/2),this.size(DivisionBulletAttr.width,DivisionBulletAttr.height),this._radius=DivisionBulletAttr.width/2}return __extends(e,t),e.prototype.init=function(t,e,i){var s=Utils.floatN(DivisionBulletAttr.velocity-12*(1-e));this.loadImage(Assets.Img.bullet_division),this._owner=i,this._vx=Utils.floatN(s*Math.sin(t*Math.PI/180)),this._vy=Utils.floatN(-1*s*Math.cos(t*Math.PI/180))},e.prototype.fixBallPosition=function(t){var e=!global.syn;i=Utils.fixCollision(Utils.p(this.x,this.y),Utils.p(t.x,t.y),this.radius,t.radius,e),this.x=i[0],this.y=i[1],t.x=i[2],t.y=i[3];Utils.distanceToLine(t.x,t.y,this.x,this.y,this.vx,this.vy);SoundManager.playSound(Assets.Sound.hit_001,1);var i},e}(Bullet),SmokeBulletAttr={width:40,height:40,imgWidth:39,imgHeight:39,velocity:20},SmokeBullet=function(t){function e(){t.call(this),this._type="smoke",this.pivot(SmokeBulletAttr.imgWidth/2,SmokeBulletAttr.imgHeight/2),this.size(SmokeBulletAttr.width,SmokeBulletAttr.height),this._radius=SmokeBulletAttr.width/2}return __extends(e,t),e.prototype.init=function(t,e,i){var s=Utils.floatN(IceBulletAttr.velocity-12*(1-e));this.loadImage(Assets.Img.bullet_smoke),this._owner=i,this._vx=Utils.floatN(s*Math.sin(t*Math.PI/180)),this._vy=Utils.floatN(-1*s*Math.cos(t*Math.PI/180))},e.prototype.update=function(){t.prototype.update.call(this),("self"===this._owner&&this.y<160||"opponent"===this._owner&&this.y>config.gameHeight-160)&&(this.makeSmoke(),this.release())},e.prototype.fixBallPosition=function(t){var e=!global.syn;i=Utils.fixCollision(Utils.p(this.x,this.y),Utils.p(t.x,t.y),this.radius,t.radius,e),this.x=i[0],this.y=i[1],t.x=i[2],t.y=i[3];Utils.distanceToLine(t.x,t.y,this.x,this.y,this.vx,this.vy);SoundManager.playSound(Assets.Sound.hit_001,1);var i},e.prototype.makeSmoke=function(){var t=this,e=Utils.p(this.x,this.y),i=AnimationManager.getOrCreate("smoke",500,250,250,125),s=Main.Instance.gamePage,o="self"===this._owner?"stopSmoke1":"stopSmoke2";"self"===this._owner&&Game.Instance.smoke1?(Game.Instance.smoke1,Game.Instance.timer.runTaskByName(o)):"opponent"===this._owner&&Game.Instance.smoke2&&(Game.Instance.smoke2,Game.Instance.timer.runTaskByName(o)),i.pos(config.gameWidth/2,e.y),i.interval=100,i.scale(.1,.1),i.zOrder=DisplayOrder.Smoke,Tween.to(i,{scaleX:1,scaleY:1},300),s.addChild(i),i.play(0,!0,"smoke"),SoundManager.playSound(Assets.Sound.smoke,0),Game.Instance.timer.setTimeout(function(){"self"===t._owner?Game.Instance.smoke1=null:Game.Instance.smoke2=null,Game.Instance.smoke1||Game.Instance.smoke2||SoundManager.stopSound(Assets.Sound.smoke),Tween.to(i,{alpha:0},800,Ease.linearInOut,Handler.create(t,function(){i.alpha=1,Pool.recover("smoke",i),i.removeSelf()}))},500,this,o,!0),"self"===this._owner?Game.Instance.smoke1=i:Game.Instance.smoke2=i},e}(Bullet),BombBulletAttr={width:40,height:40,imgWidth:39,imgHeight:39,velocity:20},BombBullet=function(t){function e(){t.call(this),this._type="bomb",this.pivot(BombBulletAttr.imgWidth/2,BombBulletAttr.imgHeight/2),this.size(BombBulletAttr.width,BombBulletAttr.height),this._radius=BombBulletAttr.width/2}return __extends(e,t),e.prototype.init=function(t,e,i){var s=Utils.floatN(BombBulletAttr.velocity-12*(1-e));this.loadImage(Assets.Img.bullet_bomb),this._owner=i,this._vx=Utils.floatN(s*Math.sin(t*Math.PI/180)),this._vy=Utils.floatN(-1*s*Math.cos(t*Math.PI/180))},e.prototype.update=function(){this.collision(),this.x=Utils.floatN(this.x+this._vx),this.y=Utils.floatN(this.y+this._vy),this._nextX=this.x+this._vx,this._nextY=this.y+this._vy,(this._nextX<this.width/2||this._nextX>config.gameWidth-this.width/2)&&(this.x=this._nextX<this.width/2?this.width/2:config.gameWidth-this.width/2,this.boomEffect(),this.boom()),(this.y<-1*this.width/2||this.y>config.gameHeight+this.height/2)&&this.release()},e.prototype.collisionBullets=function(t,e){var i=!global.syn,s={x:t.x+t.vx,y:t.y+t.vy,radius:t.radius},o={x:e.x+e.vx,y:e.y+e.vy,radius:e.radius};Utils.isCircleCollision(s,o)&&(n=Utils.fixCollision(Utils.p(t.x,t.y),Utils.p(e.x,e.y),t.radius,e.radius,i),t.x=n[0],t.y=n[1],e.x=n[2],e.y=n[3],a=Utils.compBallRebound(Utils.p(t.x,t.y),Utils.p(e.x,e.y),{vx:t.vx,vy:t.vy},{vx:e.vx,vy:e.vy},i),t.vx=a[0],t.vy=a[1],e.vx=a[2],e.vy=a[3],this.boomEffect(),this.boom());var n,a},e.prototype.calculateBallPhysics=function(t){var e=!global.syn;i=Utils.fixCollision(Utils.p(this.x,this.y),Utils.p(t.x,t.y),this.radius,t.radius,e),this.x=i[0],this.y=i[1],t.x=i[2],t.y=i[3];Utils.distanceToLine(t.x,t.y,this.x,this.y,this.vx,this.vy);t.compRDirection(this.x,this.y,this.vx,this.vy),s=Utils.compBallRebound(Utils.p(this.x,this.y),Utils.p(t.x,t.y),{vx:this.vx,vy:this.vy},{vx:t.vx,vy:t.vy},e),this.vx=s[0],this.vy=s[1],t.vx=s[2],t.vy=s[3],this.boomEffect(),this.boom(),"self"===this._owner&&t.isNormalStatus()&&Socket.Instance.causeExplosion();var i,s},e.prototype.boom=function(){var t=Game.Instance.ball;if(this.boomPhysics(t),global.syn){for(var e=0,i=Bullet.myBullets;e<i.length;e++){var s=i[e];this.boomPhysics(s)}for(var o=0,n=Bullet.yourBullets;o<n.length;o++){var s=n[o];this.boomPhysics(s)}}else{for(var a=0,r=Bullet.yourBullets;a<r.length;a++){var s=r[a];this.boomPhysics(s)}for(var l=0,h=Bullet.myBullets;l<h.length;l++){var s=h[l];this.boomPhysics(s)}}},e.prototype.boomPhysics=function(t){var e=!global.syn,i=this.x,s=this.y,o=t.x,n=t.y;e&&(i=Utils.floatN(config.gameWidth-i),s=Utils.floatN(config.gameHeight-s),o=Utils.floatN(config.gameWidth-o),n=Utils.floatN(config.gameHeight-n));var a=Utils.floatN(Utils.pLength(Utils.p(o,n),Utils.p(i,s)));if(a<=180&&a>0){var r=(180-a)/800;t.vx=Utils.floatN((o-i)*r),t.vy=Utils.floatN((n-s)*r),e&&(t.vx=Utils.floatN(t.vx*-1),t.vy=Utils.floatN(t.vy*-1))}},e.prototype.boomEffect=function(){var t=Utils.p(this.x,this.y),e=AnimationManager.getOrCreate("boom",291,291,145,145),i=Main.Instance.gamePage;e.pos(t.x,t.y),e.off(LayaEvent.COMPLETE,e,function(){}),e.on(LayaEvent.COMPLETE,e,function(){Pool.recover("boom",e),e.removeSelf()}),i.addChild(e),e.play(0,!1,"boom"),SoundManager.playSound(Assets.Sound.boom_002),this.release()},e}(Bullet),CannonAttr={width:71,height:111,imgWidth:71,imgHeight:111},Cannon=function(t){function e(e){t.call(this),this.loadImage(e?Assets.Img.cannon_y:Assets.Img.cannon_m),this.pivot(CannonAttr.imgWidth/2,75),this.pos(config.gameWidth/2,config.gameHeight),this.size(CannonAttr.width,CannonAttr.height),this.zOrder=DisplayOrder.Cannon,this.opponent=e,e?(this.pos(config.gameWidth/2,0),this.addShadow(),this.setAngle(this.rotation+180)):this.addShadow()}return __extends(e,t),e.prototype.getAngle=function(){return this.rotation},e.prototype.setAngle=function(t){!this.opponent&&(t>82||t<-82)&&(t=t>0?82:-82),this.opponent&&(t<98||t>262)&&(t=t<98?98:262),this.rotation=t,this._shadow.rotation=t},e.prototype.shoot=function(t,e,i){var s,o=Main.Instance.gamePage;this.opponent?(this.setAngle(t+180),s=Bullet.getOrCreate(t+180,e,i,"opponent")):s=Bullet.getOrCreate(t,e,i,"self"),s?o.addChild(s):console.log("Bullet is lock."),s.pos(this.x,this.y),SoundManager.playSound(Assets.Sound.shoot,1)},e.prototype.addShadow=function(){this._shadow=new Sprite,this._shadow.loadImage(Assets.Img.cannon_shadow),this._shadow.pivot(41,75),this.opponent?this._shadow.pos(this.x-20,this.y-10):this._shadow.pos(this.x-20,this.y+10),this._shadow.zOrder=DisplayOrder.Shadow,Main.Instance.gamePage.addChild(this._shadow)},e.prototype.remove=function(){this.removeSelf(),this._shadow.removeSelf()},e}(laya.display.Sprite),ProcessAttr={width:22,height:188,bulletCost:.2},BulletProcess=function(t){function e(){t.call(this),this.loadImage(Assets.Img.processBg),this.size(ProcessAttr.width,ProcessAttr.height),this.pivot(ProcessAttr.width,ProcessAttr.height),this.zOrder=DisplayOrder.ProcessBar,this.repos(),this.pmask=new Sprite,this.pmask.loadImage(Assets.Img.process),this.pmask.size(ProcessAttr.width,ProcessAttr.height),this.pmask.pos(0,ProcessAttr.height/2),this.process=new Sprite,this.process.loadImage(Assets.Img.process),this.process.size(ProcessAttr.width,ProcessAttr.height),this.process.mask=this.pmask,this.percent=.5,this.addChild(this.process),Laya.stage.addChild(this)}return __extends(e,t),e.prototype.update=function(){if(this.pmask.y<=0)return void(this.pmask.y=0);this.pmask.pos(0,this.pmask.y-.5),this.percent=1-this.pmask.y/ProcessAttr.height},e.prototype.costOne=function(t){return t||(t=1),t<.5&&(t=.5),this.percent>=ProcessAttr.bulletCost*t&&(this.percent-=ProcessAttr.bulletCost*t,this.pmask.pos(0,ProcessAttr.height*(1-this.percent)),!0)},e.prototype.repos=function(){Laya.stage.width>=1280?this.pos(global.rightEdge+400,Laya.stage.height):this.pos(Laya.stage.width,Laya.stage.height)},e.prototype.remove=function(){this.removeSelf()},e}(laya.display.Sprite),TimerAttr={width:102,height:40,time:180},Timer=function(t){function e(){t.call(this),this._frame=0,this._timeValue=TimerAttr.time,this._timeTaskList=[],this.loadImage(Assets.Img.timerBg),this.zOrder=DisplayOrder.Timer,this.size(TimerAttr.width,TimerAttr.height),this.pivot(this.width,0),this.repos(),this._time=new LayaText,this._time.font="Arial",this._time.fontSize=33,this._time.color="#000000",this._time.align="center",this._time.valign="middle",this._time.size(110,38),this._time.pivot(this._time.width/2,this._time.height/2),this._time.pos(this.width/2+2,this.height/2-2),this._time.text=this.convertToString(this._timeValue),this.addChild(this._time),Laya.stage.addChild(this)}return __extends(e,t),Object.defineProperty(e.prototype,"timeValue",{get:function(){return this._timeValue},enumerable:!0,configurable:!0}),e.prototype.update=function(){++this._frame>=60&&(this._timeValue--,this._time.text=this.convertToString(this._timeValue),this._frame=0,30===this._timeValue&&(this._time.color="#F41414"),this._timeValue<=0&&0!=Game.Instance.status&&Game.Instance.gameOver());for(var t=0,e=this._timeTaskList;t<e.length;t++){var i=e[t];i.frame++,i.frame>=i.goalFrame&&(i.goalFunc.apply(i.context),this._timeTaskList.splice(this._timeTaskList.indexOf(i),1))}},e.prototype.isTimeout=function(){return this._timeValue<=0},e.prototype.repos=function(){Laya.stage.width>=1280?this.pos(global.rightEdge+400,0):this.pos(Laya.stage.width,0)},e.prototype.convertToString=function(t){var e,i,s="";return t<0?"00:00":(e=Math.floor(t/60),i=t%60,e<10?s=s+"0"+e.toString():s+=e.toString(),s+=":",s=i<10?s+"0"+i.toString():s+=i.toString())},e.prototype.setTimeout=function(t,e,i,s,o){this._timeTaskList.push({frame:0,goalFrame:e,goalFunc:t,context:i,taskName:s||"",clear:o||!1})},e.prototype.runTaskByName=function(t){for(var e=0,i=this._timeTaskList;e<i.length;e++){var s=i[e];s.taskName===t&&(s.goalFunc.apply(s.context),this._timeTaskList.splice(this._timeTaskList.indexOf(s),1))}},e.prototype.clearTaskList=function(){for(var t=0,e=this._timeTaskList;t<e.length;t++){var i=e[t];i.clear&&i.goalFunc.apply(i.context)}this._timeTaskList=[]},e.prototype.clearTaskByName=function(t){for(var e=0,i=this._timeTaskList;e<i.length;e++){var s=i[e];s.taskName===t&&this._timeTaskList.splice(this._timeTaskList.indexOf(s),1)}},e.prototype.remove=function(){this.removeSelf()},e}(laya.display.Sprite),DashLine=function(t){function e(e,i){t.call(this),this.zOrder=DisplayOrder.AssistLine,this.pos(e,i)}return __extends(e,t),e.prototype.drawAssistLine=function(t){var e,i,s,o,n={x:0,y:0};n.x=t.x-this.x,n.y=t.y-this.y,e=Utils.pLength(t,Utils.p(this.x,this.y)),i=Math.ceil(e/20),s=20*n.x/e,o=20*n.y/e,this.clearLines();for(var a=0;a<i;a++)if(a%2!=0){var r=new Sprite;this.addChild(r),r.graphics.drawLine((a-1)*s,(a-1)*o,a*s,a*o,"#ffffff",2)}},e.prototype.clearLines=function(){this.removeChildren()},e.prototype.remove=function(){this.removeSelf()},e}(laya.display.Sprite),ToolTag=function(t){function e(e){t.call(this),this._select=!1,this._id=e,this._name=Tool[e].name,this.loadImage(Assets.Img["tooltag_"+Tool[e].tag]),this.size(72,34),this._text=new LayaText,this._text.text=this._name,this._text.align="right",this._text.valign="middle",this._text.size(68,34),this._text.font="幼圆",this._text.fontSize=20,this.addChild(this._text)}return __extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.isSelect=function(){return!!this._select},e.prototype.select=function(){this._select||(this._select=!0,Tween.clearAll(this),Tween.to(this,{x:-8},200,Ease.backInOut))},e.prototype.unselect=function(){this._select&&(this._select=!1,Tween.clearAll(this),Tween.to(this,{x:-52},200,Ease.backInOut))},e.prototype.useTag=function(t){this._select=!1,this.alpha=0,this.changeTag(t),this.x=-72,this.alpha=1,Tween.to(this,{x:-52},300,Ease.backInOut)},e.prototype.changeTag=function(t){this._id=t,this._name=Tool[t].name,this.loadImage(Assets.Img["tooltag_"+Tool[t].tag]),this._text.text=this._name},e}(laya.display.Sprite),ToolTagContainer=function(t){function e(){t.call(this),this._tagList=[],this._tagIds=["IceBullet","DivisionBullet","SmokeBullet","BombBullet"],this._nextTagIds=[],this._lock=!1;var e=new ToolTag("StandardBullet"),i=new ToolTag("IceBullet"),s=new ToolTag("DivisionBullet");this._tagList.push(e),this._tagList.push(i),this._tagList.push(s),e.pos(-52,0),i.pos(-52,47),s.pos(-52,94),e.select(),this._selectIndex=0,this._nextTagIds=this.getHiddenTagIds(),this.zOrder=DisplayOrder.ToolContainer,this.repos(),this.addChildren(e,i,s),Laya.stage.addChild(this)}return __extends(e,t),Object.defineProperty(e.prototype,"tagList",{get:function(){return this._tagList},enumerable:!0,configurable:!0}),e.prototype.isLock=function(){return this._lock},e.prototype.lock=function(){this._lock=!0},e.prototype.unlock=function(){this._lock=!1},e.prototype.isSelectFirst=function(){return 0===this._selectIndex},e.prototype.getSelectedToolId=function(){return this._tagList[this._selectIndex].id},e.prototype.getHiddenTagIds=function(){for(var t=this._tagIds.slice(0,this._tagIds.length),e=0,i=this._tagList;e<i.length;e++){var s=i[e];t.indexOf(s.id)>=0&&t.splice(t.indexOf(s.id),1)}return t},e.prototype.useSelectTag=function(){if(this.unlock(),0!==this._selectIndex){var t,e=this._tagList[this._selectIndex];this._nextTagIds.push(e.id),this._selectIndex=0,this._tagList[this._selectIndex].select(),t=this._nextTagIds.shift(),e.useTag(t)}},e.prototype.selectTag=function(t){this._selectIndex!==t&&(this._tagList[this._selectIndex].unselect(),this._tagList[t].select(),this._selectIndex=t)},e.prototype.selectNext=function(){var t;navigator.vibrate&&navigator.vibrate(100),this._tagList[this._selectIndex].unselect(),t=this._selectIndex+1,t===this._tagList.length&&(t=0),this._tagList[t].select(),this._selectIndex=t},e.prototype.selectPrevious=function(){var t;navigator.vibrate&&navigator.vibrate(100),this._tagList[this._selectIndex].unselect(),t=this._selectIndex-1,t<0&&(t=this._tagList.length-1),this._tagList[t].select(),this._selectIndex=t},e.prototype.select=function(t){for(var e=0,i=this._tagList;e<i.length;e++){i[e].unselect()}this._tagList[t].select(),this._selectIndex=t},e.prototype.repos=function(){Laya.stage.width>=1280?this.pos(global.leftEdge-348,336):this.pos(0,336)},e.prototype.remove=function(){this.removeChildren(),this.removeSelf()},e}(laya.display.Sprite),BtnSwitch=function(t){function e(){t.call(this),this._funcLock=!1,this.loadImage(Assets.Img.btn_switch_bg),this.repos(),this.size(80,210),this.zOrder=DisplayOrder.BtnSwitch,this._centerBtn=new Sprite,this._centerBtn.loadImage(Assets.Img.btn_switch_center),this._centerBtn.size(50,50),this._centerBtn.pivot(25,25),this._centerBtn.pos(40,this.height/2),this.on(LayaEvent.MOUSE_DOWN,this,this.onMouseDown),this.addChild(this._centerBtn),Laya.stage.addChild(this)}return __extends(e,t),e.prototype.onMouseDown=function(t){Tween.clearAll(this._centerBtn),Laya.stage.on(LayaEvent.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.on(LayaEvent.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(LayaEvent.MOUSE_OUT,this,this.onMouseUp)},e.prototype.onMouseUp=function(t){Laya.stage.off(LayaEvent.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(LayaEvent.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(LayaEvent.MOUSE_OUT,this,this.onMouseUp),this._funcLock=!1,Tween.to(this._centerBtn,{x:40,y:this.height/2},500,Ease.circOut)},e.prototype.onMouseMove=function(t){var e,i,s,o,n;if(e=Utils.p(Laya.stage.mouseX,Laya.stage.mouseY),o=Utils.p(this.width/2,this.height/2),s=Utils.p(e.x-this.x,e.y-this.y),i=Utils.pLength(s,o),n=this.height/2-this._centerBtn.height/2,i>=n)return this._funcLock===!1&&(s.y>o.y?(Game.Instance.toolTagContainer.selectNext(),SoundManager.playSound(Assets.Sound.button_001)):s.y<o.y&&(Game.Instance.toolTagContainer.selectPrevious(),SoundManager.playSound(Assets.Sound.button_001)),this._funcLock=!0),void(s.y>o.y?this._centerBtn.y=this.height-this._centerBtn.height/2:this._centerBtn.y=this._centerBtn.height/2);this._centerBtn.y=s.y},e.prototype.beMouseUp=function(){this.onMouseUp()},e.prototype.repos=function(){Laya.stage.width>=1280?this.pos(global.leftEdge-400,500):this.pos(0,500)},e.prototype.remove=function(){this.removeSelf()},e}(laya.display.Sprite),ScorePanel=function(t){function e(e){t.call(this),this.type=e,this.loadImage(Assets.Img.scoreBg),this.zOrder=DisplayOrder.ScorePanel,"mine"===e?this.userName=Socket.Instance.mName:"your"===e&&(this.userName=Socket.Instance.yName),this.repos(),this.initInfo()}return __extends(e,t),e.prototype.initInfo=function(){var t;this._name=new LayaText,this._score=new LayaText,this._balls=new LayaText,"mine"===this.type?t=ScoreManager.Instance.mscore:"your"===this.type&&(t=ScoreManager.Instance.yscore),this._name.fontSize=20,this._name.pos(6,2),this._name.text=this.userName,this._score.fontSize=16,this._score.pos(5,28),this._score.text="得分:"+t.score.toString(),this._balls.fontSize=16,this._balls.pos(84,28),this._balls.size(18,18),this._balls.align="center",this._balls.text=t.balls.toString(),this.addChild(this._name),this.addChild(this._score),this.addChild(this._balls)},e.prototype.updateScore=function(t){this._score.text="得分:"+t.toString()},e.prototype.updateBalls=function(t){this._balls.text!==t.toString()&&Tween.from(this._balls,{y:10,alpha:0},300,Ease.backIn),
this._balls.text=t.toString()},e.prototype.repos=function(){Laya.stage.width>=1280?"mine"===this.type?this.pos(global.leftEdge-400,Laya.stage.height-47):"your"===this.type&&this.pos(global.leftEdge-400,0):"mine"===this.type?this.pos(0,Laya.stage.height-47):"your"===this.type&&this.pos(0,0)},e.prototype.remove=function(){this.removeSelf()},e}(laya.display.Sprite),View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.startUI.uiView)},i.uiView={type:"View",child:[{props:{x:132,y:396,skin:"start/btnbg.png",label:"随机匹配",width:216,height:86,sizeGrid:"0,0,0,0",labelSize:37,labelBold:!1,var:"btnMatch",labelFont:"等线",labelColors:"#000,#000,#000,#000",stateNum:"3",disabled:!1,mouseThrough:!1},type:"Button"},{props:{x:132,y:503,skin:"start/btnbg.png",label:"创建房间",width:216,height:86,sizeGrid:"2,4,-2,1",labelSize:37,labelBold:!1,var:"btnCreateRoom",labelFont:"等线",toggle:!1,labelColors:"#000,#000,#000,#000",stateNum:"3"},type:"Button"},{props:{x:132,y:609,skin:"start/btnbg.png",label:"加入房间",width:216,height:86,sizeGrid:"2,4,-2,1",labelSize:37,labelBold:!1,var:"btnJoinRoom",labelFont:"等线",toggle:!1,labelColors:"#000,#000,#000,#000",stateNum:"3"},type:"Button"},{props:{x:8,y:160,skin:"start/logo.png",width:462,height:100},type:"Image"}],props:{width:480,height:800,labelColors:"(#333,#567356,#333#567356)"}},i}(View);t.startUI=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ResultPageUI.uiView)},i.uiView={type:"View",child:[{props:{x:4,y:-4,skin:"ResultPage/resultbg.png"},type:"Image"},{props:{x:60,y:-7,var:"word"},type:"Image"},{props:{x:62,y:160,text:"myname",width:94,height:23,var:"myNameText",fontSize:20,color:"#101010",font:"微软雅黑"},type:"Label"},{props:{x:200,y:160,text:"yourname",width:109,height:23,var:"yourNameText",fontSize:20,color:"#3A3A3A",font:"微软雅黑"},type:"Label"},{props:{x:61,y:202,text:"进球数",width:94,height:23,fontSize:20,color:"#969696",font:"等线"},type:"Label"},{props:{x:200,y:202,text:"进球数",width:94,height:23,fontSize:20,color:"#969696",font:"等线"},type:"Label"},{props:{x:63,y:232,text:"0",width:94,height:23,fontSize:20,color:"#00C6F4",font:"微软雅黑",var:"myBalls"},type:"Label"},{props:{x:200,y:232,text:"0",width:77,height:23,fontSize:20,color:"#6D6D6D",font:"微软雅黑",var:"yourBalls"},type:"Label"},{props:{x:62,y:272,text:"总得分",width:94,height:23,fontSize:20,color:"#969696",font:"等线"},type:"Label"},{props:{x:200,y:272,text:"总得分",width:94,height:23,fontSize:20,color:"#969696",font:"等线"},type:"Label"},{props:{x:62,y:310,text:"0",width:94,height:23,fontSize:20,color:"#00C6F4",font:"微软雅黑",var:"myScore"},type:"Label"},{props:{x:200,y:310,text:"0",width:94,height:23,fontSize:20,color:"#6D6D6D",font:"微软雅黑",var:"yourScore"},type:"Label"},{props:{x:123,y:354,label:"返回",width:122,height:36,labelFont:"等线",labelStrokeColor:"#000000",labelSize:22,strokeColors:"#0BE0DA",stateNum:"1",labelColors:"#ffffff",skin:"ResultPage/btnbg.png",var:"backBtn"},type:"Button"}],props:{font:"等线"}},i}(View);t.ResultPageUI=i}(ui||(ui={}));var ResultPage=function(t){function e(e){t.call(this),this.word.loadImage("ResultPage/"+e.result+".png"),this.myNameText.text=e.myname,this.yourNameText.text=e.yourname,this.myBalls.text=e.myballs,this.yourBalls.text=e.yourballs,this.myScore.text=e.myscore,this.yourScore.text=e.yourscore,this.pivot(this.width/2,this.height/2),this.pos(Laya.stage.width/2,Laya.stage.height/2),this.zOrder=DisplayOrder.ResultPage,this.backBtn.on(LayaEvent.CLICK,this,this.onBtnBack)}return __extends(e,t),e.prototype.onBtnBack=function(){SoundManager.playSound(Assets.Sound.button_001),Main.Instance.backToMenu(),this.remove()},e.prototype.repos=function(){this.pos(Laya.stage.width/2,Laya.stage.height/2)},e.prototype.remove=function(){this.removeSelf()},e}(ui.ResultPageUI),ScoreConfig={bulletExplosions:1,balls:8,winBalls:10},ScoreManager=function(){function t(){this.mballs=0,this.yballs=0}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mscore",{get:function(){return this._mscore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yscore",{get:function(){return this._yscore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"myScorePanel",{get:function(){return this._myScorePanel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yourScorePanel",{get:function(){return this._yourScorePanel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultView",{get:function(){return this._resultView},enumerable:!0,configurable:!0}),t.prototype.initScore=function(){this._mscore={score:0,balls:0,bulletExplosions:0},this._yscore={score:0,balls:0,bulletExplosions:0},this._myScorePanel=new ScorePanel("mine"),this._yourScorePanel=new ScorePanel("your"),Laya.stage.addChild(this._myScorePanel),Laya.stage.addChild(this._yourScorePanel)},t.prototype.setScores=function(t,e){"mine"===t?(this._mscore.balls=e.balls,this._mscore.bulletExplosions=e.explosions,this._mscore.score=e.score):"your"===t&&(this._yscore.balls=e.balls,this._yscore.bulletExplosions=e.explosions,this._yscore.score=e.score),this.updateScore()},t.prototype.updateScore=function(){this.myScorePanel.updateScore(this._mscore.score),this.myScorePanel.updateBalls(this._mscore.balls),this.yourScorePanel.updateScore(this._yscore.score),this.yourScorePanel.updateBalls(this._yscore.balls)},t.prototype.removeScorePanel=function(){this.myScorePanel&&this.myScorePanel.remove(),this.yourScorePanel&&this.yourScorePanel.remove()},t.prototype.checkBalls=function(e){"mine"===e&&t.Instance.mballs>=ScoreConfig.winBalls?Game.Instance.gameOver():"your"===e&&t.Instance.yballs>=ScoreConfig.winBalls&&Game.Instance.gameOver()},t.prototype.showGameResult=function(t){var e,i,s,o,n;t=t.scores,this._resultView&&this.resultView.remove();for(var a in t)t[a].id===Socket.Instance.getUid()&&(e=t[a],s=a);if(!e)return void console.log("error: user id not exist in scores data.");i=t[1-s],o=e.score>i.score?"win":e.score<i.score?"lose":"tie",n={result:o,myname:e.name,yourname:i.name,myballs:e.balls,yourballs:i.balls,myscore:e.score,yourscore:i.score},this._resultView=new ResultPage(n),this._resultView.scale(0,0),Laya.stage.addChild(this._resultView),Tween.to(this._resultView,{scaleX:1,scaleY:1},500,Ease.backOut),"win"===o||"tie"===o?SoundManager.playSound(Assets.Sound.gamewin):SoundManager.playSound(Assets.Sound.gameover)},t.prototype.removeResultView=function(){this._resultView&&this._resultView.remove()},t}(),MsgAttr={width:408,height:316},MsgManager=function(){function t(){this._showing=!1}return Object.defineProperty(t.prototype,"msg",{get:function(){return this._msg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tipsText",{get:function(){return this._tipsText},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),t.prototype.showMessage=function(t,e,i){var s=this;this._msg||(this._msgContainer=new View,this._msgContainer.zOrder=DisplayOrder.Msg,this._msgContainer.mouseEnabled=!0,this._msg=new Sprite,this._msg.loadImage(Assets.Img.msgBg),this._msg.pivot(MsgAttr.width/2,MsgAttr.height/2),this._msg.size(MsgAttr.width,MsgAttr.height),this._msg.name=DisplayName.Loading,this._msg.pos(Laya.stage.width/2,Laya.stage.height/2),this._textSprite=new LayaText,this._textSprite.font="等线",this._textSprite.overflow=LayaText.HIDDEN,this._textSprite.wordWrap=!0,this._textSprite.align="center",this._textSprite.valign="middle",this._textSprite.size(260,300),this._textSprite.pivot(this._textSprite.width/2,this._textSprite.height/2),this._textSprite.pos(this._msg.width/2,this._msg.height/2),this._msg.addChild(this._textSprite)),this._showing=!0,Tween.clearAll(this._msg),this._msg.alpha=0,this._msg.scale(0,0),this._textSprite.text=t,this._textSprite.color="#000000",this._textSprite.fontSize=46,e&&(this._textSprite.fontSize=e),Tween.to(this._msg,{alpha:1,scaleX:1,scaleY:1},600,Ease.backInOut,Handler.create(this,function(){s._showing=!1,i&&i.apply(s)})),this._msgContainer.addChild(this._msg),Laya.stage.addChild(this._msgContainer)},t.prototype.removeMessage=function(t){var e=this;this._showing||Tween.to(this._msg,{alpha:0,scaleX:0,scaleY:0},500,null,Handler.create(this,function(){t&&t.apply(e),Laya.stage.removeChild(e._msgContainer),e._msgContainer.removeChildren(),e._showing=!1}))},t.prototype.setText=function(t,e){this._textSprite&&(this._textSprite.text=t),e&&(this._textSprite.color=e)},t.prototype.showTips=function(t){this._tipsText=new LayaText,this._tipsText.font="等线",this._tipsText.overflow=LayaText.HIDDEN,this._tipsText.wordWrap=!0,this._tipsText.align="left",this._tipsText.valign="middle",this._tipsText.size(226,300),this._tipsText.pivot(this._tipsText.width/2,this._tipsText.height/2),this._tipsText.pos(Laya.stage.width/2,Laya.stage.height-100),this._tipsText.text=t,this._tipsText.color="#ffffff",this._tipsText.fontSize=26,this.removeTips(),Laya.stage.addChild(this._tipsText)},t.prototype.removeTips=function(){this._tipsText&&Laya.stage.removeChild(this._tipsText)},t}(),Game=function(){function t(){this.keyframe=0,this.curframe=0,this._status=-1,this._updateList=[],this.ballDirections=[],this.ballDirectionFactor=0}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ball",{get:function(){return this._ball},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bulletProcess",{get:function(){return this._bulletProcess},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timer",{get:function(){return this._timer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"counter",{get:function(){return this._counter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toolTagContainer",{get:function(){return this._toolTagContainer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"btnSwitch",{get:function(){return this._btnSwitch},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateList",{get:function(){return this._updateList},enumerable:!0,configurable:!0}),t.prototype.getBallDirection=function(){if(this.ballDirections.length){var t=this.ballDirections.shift();return this.ballDirections.push(t),t}},t.prototype.getCounter=function(t){return this._counter=new CountDown(3,t),this._counter},t.prototype.initScene=function(){this.initBG(),this.initRole(),this.initUI()},t.prototype.startLoop=function(){this._updateList.splice(0,180),Laya.timer.frameLoop(1,this,this.update)},t.prototype.initBG=function(){var t=Main.Instance.gamePage;this._gameBg=new Sprite,this._gameBg.loadImage(Assets.Img.gamebg),this._gameBg.pivot(640,400),this._gameBg.pos(config.gameWidth/2,config.gameHeight/2),t.addChild(this._gameBg)},t.prototype.initRole=function(){var t=Main.Instance.gamePage;this._myCannon=new Cannon(!1),this._yourCannon=new Cannon(!0),t.addChild(this._myCannon),t.addChild(this._yourCannon)},t.prototype.initUI=function(){ScoreManager.Instance.initScore(),this._bulletProcess=new BulletProcess,this._pprocess=new PProcess,this._timer=new Timer,this._toolTagContainer=new ToolTagContainer,this._btnSwitch=new BtnSwitch,this._dashLine=new DashLine(this._myCannon.x,this._myCannon.y),Main.Instance.gamePage.addChild(this._dashLine)},t.prototype.initBall=function(t){var e=Main.Instance.gamePage;this._ball=new Ball(t),e.addChild(this._ball)},t.prototype.initControl=function(){this._gameBg.on(LayaEvent.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(LayaEvent.KEY_PRESS,this,this.onKeyPress)},t.prototype.stopControl=function(){this._gameBg.off(LayaEvent.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.off(LayaEvent.KEY_PRESS,this,this.onKeyPress)},t.prototype.onKeyPress=function(e){var i=t.Instance.toolTagContainer;switch(e.keyCode){case 49:i.selectTag(0);break;case 50:i.selectTag(1);break;case 51:i.selectTag(2)}},t.prototype.onMouseDown=function(t){this._gameBg.on(LayaEvent.MOUSE_MOVE,this,this.onMouseMove),this._gameBg.on(LayaEvent.MOUSE_UP,this,this.onMouseUp),this._gameBg.on(LayaEvent.MOUSE_OUT,this,this.onMouseUp),this._pprocess.start();var e=Utils.p(Laya.stage.mouseX-global.leftEdge,Laya.stage.mouseY),i=Utils.p(e.x-this._myCannon.x,e.y-this._myCannon.y),s=-1*Math.atan(i.x/i.y)*180/Math.PI;this._dashLine.drawAssistLine(e),this._myCannon.setAngle(s)},t.prototype.onMouseUp=function(e){var i=t.Instance.toolTagContainer;if(this._gameBg.off(LayaEvent.MOUSE_MOVE,this,this.onMouseMove),this._gameBg.off(LayaEvent.MOUSE_UP,this,this.onMouseUp),this._gameBg.off(LayaEvent.MOUSE_OUT,this,this.onMouseUp),this._dashLine.clearLines(),0!==this._status&&!i.isLock()&&this.bulletProcess.costOne(2*this._pprocess.percent+(i.isSelectFirst()?0:.4))){var s={angle:this._myCannon.getAngle(),power:this._pprocess.percent,bulletType:i.getSelectedToolId()};i.lock(),Socket.Instance.sendCtrl(s)}this._pprocess.stop()},t.prototype.onMouseMove=function(t){var e=Utils.p(Laya.stage.mouseX-global.leftEdge,Laya.stage.mouseY),i=Utils.p(e.x-this._myCannon.x,e.y-this._myCannon.y),s=-1*Math.atan(i.x/i.y)*180/Math.PI;this._dashLine.drawAssistLine(e),this._myCannon.setAngle(s)},t.prototype.update=function(){this.checkUpdateList()},t.prototype.checkUpdateList=function(){var t=this._updateList.length;if(t>0&&t<10){var e=this._updateList.splice(0,1)[0];this.runFramePack(e),this.runFrameLogic()}else{if(!(t>=10))return;for(var i=t<100?2:Math.ceil(t/50),e=this._updateList.splice(0,i),s=0;s<e.length;s++)this.runFramePack(e[s]),this.runFrameLogic()}},t.prototype.runFrameLogic=function(){if(0===global.syn){for(var t=0,e=Bullet.myBullets;t<e.length;t++){var i=e[t];i.update()}for(var s=0,o=Bullet.yourBullets;s<o.length;s++){var n=o[s];n.update()}}else if(1===global.syn){for(var a=0,r=Bullet.yourBullets;a<r.length;a++){var n=r[a];n.update()}for(var l=0,h=Bullet.myBullets;l<h.length;l++){var i=h[l];i.update()}}this._ball.update(),this._bulletProcess.update(),this._pprocess.update(),this._timer.update()},t.prototype.runFramePack=function(t){for(var e,i=Socket.Instance.getUid(),s=0,o=t.ctrls;s<o.length;s++){var n=o[s];e=n.id===i?"myrole":"yourrole",this.playData(e,n.ctrl)}this.curframe=t.keyframe},t.prototype.pushUpdateData=function(t){this._updateList.push(t)},t.prototype.clearUpdateList=function(){this._updateList.length>0&&(this._updateList=[])},t.prototype.playData=function(e,i){var s=t.Instance.toolTagContainer;0!==this._status&&("myrole"===e?(this._myCannon.shoot(i.angle,i.power,i.bulletType),s.useSelectTag()):"yourrole"===e&&this._yourCannon.shoot(i.angle,i.power,i.bulletType))},t.prototype.gameOver=function(){this._status!==-1&&(Laya.timer.clearAll(this),Bullet.boomAllBullets(),t.Instance.timer.clearTaskList(),ScoreManager.Instance.mballs=0,ScoreManager.Instance.yballs=0,this.status=0,this.clearObjects(),this.stopControl(),this.counter&&this.counter.stop())},t.prototype.clearObjects=function(){this._updateList&&(this._updateList=[]),this._bulletProcess&&this._bulletProcess.remove(),this._timer&&this._timer.remove(),this._ball&&this._ball.removeSelf(),this._myCannon&&this._myCannon.remove(),this._yourCannon&&this._yourCannon.remove(),this._pprocess&&this._pprocess.remove(),this._toolTagContainer&&this._toolTagContainer.remove(),this._btnSwitch&&this._btnSwitch.remove(),this._dashLine&&this._dashLine.remove(),ScoreManager.Instance.removeScorePanel()},t}(),global={leftEdge:0,rightEdge:0,syn:0},DisplayName={StartPage:"startpage",GamePage:"gamepage",Loading:"loading"},DisplayOrder={Background:0,StartPage:1,GamePage:2,Background_H:3,Loading:5,AssistLine:10,Shadow:15,Bullet:16,BulletBoom:18,Ball:20,Smoke:21,Cannon:22,BtnSwitch:25,ToolContainer:26,PProcess:27,ProcessBar:28,Timer:29,ResultPage:30,CountText:31,ScorePanel:32,Msg:35},Tool={StandardBullet:{tag:"bullet",name:"子弹"},IceBullet:{tag:"ice",name:"冰弹"},DivisionBullet:{tag:"division",name:"分裂弹"},SmokeBullet:{tag:"smoke",name:"烟雾弹"},BombBullet:{tag:"bomb",name:"炸弹"}},Assets={Img:{gamebg:"res/gamebg.png",cannon_m:"res/cannon_m.png",cannon_y:"res/cannon_y.png",cannon_shadow:"res/cannon_shadow.png",bulletm:"res/bullet_m.png",bullety:"res/bullet_y.png",bullet_ice:"res/bullet_ice.png",bullet_division:"res/bullet_division.png",bullet_bomb:"res/bullet_bomb.png",bullet_smoke:"res/bullet_smoke.png",ball:"res/ball.png",process:"res/process.png",processBg:"res/processbg.png",startBg:"res/startbg.png",msgBg:"res/msgbg.png",scoreBg:"res/scorebg.png",timerBg:"res/timerbg.png",pprocess:"res/pprocess.png",pprocessbg:"res/pprocessbg.png",tooltag_ice:"res/tooltag_ice.png",tooltag_division:"res/tooltag_division.png",tooltag_smoke:"res/tooltag_smoke.png",tooltag_bullet:"res/tooltag_bullet.png",tooltag_bomb:"res/tooltag_bomb.png",btn_switch_bg:"res/btn_switch_bg.png",btn_switch_center:"res/btn_switch_center.png",ball_effect_ice:"res/ice.png"},Json:{start_json:"res/start.json",result_json:"res/ResultPage.json",blue_boom:"res/blueboom.json",red_boom:"res/redboom.json",green_boom:"res/greenboom.json",boom:"res/boom.json",smoke:"res/smoke.json"},Sound:{hit_001:"res/sounds/hit001.mp3",hit_002:"res/sounds/hit002.mp3",boom_001:"res/sounds/boom001.mp3",boom_002:"res/sounds/boom002.mp3",boom_003:"res/sounds/boom003.mp3",button_001:"res/sounds/button001.mp3",shoot:"res/sounds/shoot.mp3",smoke:"res/sounds/smoke.mp3",frozen:"res/sounds/frozen.mp3",findmatch:"res/sounds/findmatch.mp3",counter:"res/sounds/counter.mp3",gamestart:"res/sounds/gamestart.mp3",gamewin:"res/sounds/gamewin.mp3",gameover:"res/sounds/gameover.mp3",mscore:"res/sounds/mscore.mp3",yscore:"res/sounds/yscore.mp3"},font:{num:"res/numfont.fnt"}},LoadingAttr={width:300,height:28},base64={loading:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAAcCAYAAADbcIJsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABx1JREFUeNrsXEtyGzcQRc9QVJY+gnMDl3WAKDeQTxB7n1ScZVIVSd5E2Tku6QC6gZ0TmD4AfYXkCFqLHLwAmA+H5Aw+jaEjufqVILFIDQbd6HnobjaglEAgEAgEAoFAIBAIBAKBQPCwQakXPL++OlNE35n2zLSuEwx0ReZd7417H+vogQWGDPCVAaaiMCYDwsqPHC56/bPH6RkTNarTieOk6NHXvzGhvofexqAlhq/Neki4NgfPW+DNY+hajHxMjLF6/zUkiNWZ+8En83rx+fxyMSlhGaJ6rai4ULPyCRWlUmVh+KpoejC/DHlRktFtC6ITzIfAsw6Ar4zQPTFEWDlGNwAdM362jLUB6Yn10pcROzLQlCtpBG8QkD33SHyaU0lZM0k1VkbNJKSQ3Yx2tfcZGrKCMwbAjEhXClX1r9L61fLizSKLsJ5f/2EIqniPojyloyNF5cy00nBXUTdLVET73VGa4vWAHsijV+KsvshYQgKGN7xyhfukhIcxRp1h7wJ+GZD6gMSPSe95WPkEMqxtJOs7hbBSPOnUxRXR5AEWQWoG0aXORzvPNMRcsCQFdz9o7ZolLL1eK6xX5rX+a3l++QvLvh1ZlbOPNJs9U5asZkeqMGRVONJqPayasJx/RSlcuG0FKR6WYhIPO1qMvFBnrIwhA0JkuECKL+NYuKAy5aKefhDzoIPpYTVTRRyvNpLM9MDC8ZgIa2zho0R79F2rh4RBE663k2Q8K3LelbbeVUdYrlXV7fL3i1fJ9n1y8+dbms9fF/O5UpasXDOEZUJC62V1ZEXtlJEiSnczkRCKgGnQWR5WpNHpA+bT4nJYiHwiEmQIXoNoOfa8ExbxIpDD8nvfxJAj7GFxwkF4Fz1KtI/+CClddZPeryV1GnsempCQdE1Yhq0MUa1r0lqtlF7dK1VVL5bnFx+ix3lyfXVKs/IjHX+jyvlxQ1gz52HVIWFNWP3cFRFFB3BBIwBG1cMLFxD04li5sd449ZSeCXxkgmll6HWpJ3VN9xzpSJWAleQPhs3MDykgA/lIKVGOGC89J5TmJ90RfT9ghMzQZbFqwkJLWKY578qQliEsGMLS9/d3JlT8dnnx5q7fRTE6wIJ+Vjb0syTlWrkhq50cVktc6E0oOnFo4tglNzCZutsvLsijUs8XHQw9LBnB8ucel83B+z45HXTNcoRLI9XpJOf0uGbea3Pjm/bE/NPZHi15lHJmO3ThX1F33ierr+ZBFQgE/8OaVJOY45KWtBqu6f4S/RBFWCc3Jhy0TNh6UVveVPHQlmOBQPBIAbWJ0Fx6qeEaVRPWaRRhUdtJQe2FXegnjpVAIJjW2domra3Kg+iQ8OEnOgQCwdfgZSUk9IphN61Jmzf1Em2xV0y1uEAgEKS5QL3q96bB1QUijrCWP/66cN+vukrUhqzaqlTs1isLBAIB27/aJypX6uBqMBbRIaG58AOqugrVVaJ2ZfQ1iQlpCQSCrDiwI6eqqcequabmmMo6R3/vXjYb71C/U9X6TFdrRVXp6iZsHYX1r1zhGso6Kb+TGqOdUvfYPX+x2TEK9Ru8Nm480R8eiLd3K6ERIwcyDeigbr8adPHH5GBlS5E3V5x9hkNzFSuHr0qLMvTjkwNM5aTcD0PPaa+YFM02MGojtsq2deccwb7W1Z35p9ukuTi5ufpI8+NTms/rfYTNXkJbi1VsvnpU1Osq+lvEgQ2TUzx8vo2xOvDA8h+SkQriiQlEJ+o0yfAaI9IJOk2VI9ovB/+0htDxMpR5vMzQNjLfkT28Snewa2CDm58TKtZT+t21U6iBivzdrTltpXvV25qzXrlqd/Pem+X55WW8h1WHhS/UavWPefkE3ZEQhrBMw6a4azPgva8ikWBoCebD8AZy9xJShAypR7OkyDHN5mf/lyZjOgKXBAOElbuNKPVjAth76Xy2MOUm7rjTLzI8fkysVJ8++waL7b+td+VCQptyakmrJqvFEFkFCevzT7/dnVxffW9I670hrKeV6VyXzX7CfjFpOy2UMvXoJictI8YkrIn39Q19qA9wNMugh8XcSxZzTyRf4w/0yNM5mPrOCZcOYiDgXUO+A4lwWFudlK9GFznsHzHTrIq6qUBoCct5Voa0zOuFso5SzsJij5kx7PTWhIAv7XlY7vC+os5hdR4VEXvVSjuHyR+JE6a4R2K+AWmbYrmEheB14MuByLBzwGuJDqd25oCV3/GE7jHHy/BCHkZYy8w16YjzZYh72J7nCKHJThxF/3xZFTzAzyXa6yT7nQkP3415VsmesMtpXV89BdHL5ojk0+0EO7FvkEsm0+RbkHX08CBhZeaUxvqnAxAvNeEimEQXc08dHRKCfUTyVPpOuX3uKR8cD4ubb2Un3ZEm2vg5LZvTGkyzifUFoD+Zd24/n1/eKYFAIBAIBAKBQCAQCAQCgeCR4z8BBgBjOfu8K+FVYgAAAABJRU5ErkJggg==",loadingBg:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAAcCAYAAADbcIJsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAbpJREFUeNrs3d8xA1EUB+CNN3lSQlRACdEBFYgKRAVGBeiACuhAOhAVWBXwFK/OlZuRmEX8zc34vpkzYezk4Tz85t61e0+r+oTH0agTH5u5AH7CIGq42m4/fHRha46QWouPftRuVEdvgV8yjDqN4Dr7UmBFWKWgOoxa00vgj9RRexFcg7kCK6+qLqK6egcsyEmE1sG7gZXD6qpynwpYvLMIrb3JLysNFwgroBS9WEQdNwZW/oOwAkrSj2zantkS5kcWbvUGKFAdW8P16RXWoZ4AherEoqrXyqurdKP9Xk+Agg0nK6xtvQAKtzkJrA29AEo3CSz/GQSWJrAABBaAwAL+bWDVWgEsS2DdaAWwLIF1qRVA4ernwFptt9OWcKAfQMHOp19+7lbjo2UASpPOe395+TkfR2prCJToKA2pmDlxNL8EfV0ZNgGU4zLCaif9MPMcVh6zs5OXXwCLlibpvH1EcoRWumArXwiwsJVVyqLpeYWNT7pPhdaJngF/LAXUQdoGvh6uOs8g1XSSw35UTx+BXw6q02o83qvxtlRr3m/KN+S71fgomnR+luGqwHfVUXdRg6bBqa89CTAAPp1jaUy8HZ8AAAAASUVORK5CYII="},Loading=function(){function t(){this.percent=0,this.container=document.createElement("div"),this.container.id="loading-container",this.bg=document.createElement("div"),this.bg.style.margin="auto",this.bg.style.position="absolute",this.bg.style.width=LoadingAttr.width+"px",this.bg.style.height=LoadingAttr.height+"px",this.bg.style.top="50%",this.bg.style.left="0",this.bg.style.right="0",this.bg.style.marginTop="20px",this.bg.style.background="url("+base64.loadingBg+")",this.process=document.createElement("div"),this.process.style.width="0px",this.process.style.height=LoadingAttr.height+"px",this.process.style.backgroundImage="url("+base64.loading+")",this.text=document.createElement("div"),this.text.innerHTML="游戏资源加载中..."+this.percent+"%",this.text.style.margin="auto",this.text.style.position="absolute",this.text.style.width=LoadingAttr.width+"px",this.text.style.height=LoadingAttr.height+"px",this.text.style.top="50%",this.text.style.left="0",this.text.style.right="0",this.text.style.color="#ffffff",this.text.style.textAlign="center",this.text.style.fontSize="26px",this.text.style.fontFamily="cursive",this.text.style.marginTop="-30px",document.body.appendChild(this.container),this.container.appendChild(this.bg),this.container.appendChild(this.text),this.bg.appendChild(this.process)}return t.prototype.setProcess=function(t){t<0&&(t=0),t>1&&(t=1),this.percent=t,this.process.style.width=LoadingAttr.width*t+"px",this.text.innerHTML="游戏资源加载中..."+Math.round(100*this.percent)+"%"},t.prototype.hide=function(){this.container.style.display="none"},t}(),CountDown=function(t){function e(e,i){t.call(this),this.font="diyfont",this.text=e.toString(),this.pivot(this.width/2,this.height/2),this.pos(config.gameWidth/2,config.gameHeight/2-10),this.zOrder=DisplayOrder.CountText,this.animateCount(3,i),SoundManager.playSound(Assets.Sound.counter,0)}return __extends(e,t),e.prototype.animateCount=function(t,e){var i=this;Laya.timer.once(1e3,this,function(){if(t--,i.text=t.toString(),t<=0)return i.remove(),e.call(i),SoundManager.stopSound(Assets.Sound.counter),void SoundManager.playSound(Assets.Sound.gamestart);i.animateCount(t,e)})},e.prototype.stop=function(){Laya.timer.clearAll(this)},e.prototype.remove=function(){this.stop(),this.removeSelf()},e}(laya.display.Text),Socket=function(){function t(){this.uid="",this._mName="",this._yName="",this._active=!0,this._socket=io.connect(config.socketServer)}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),t.prototype.getUid=function(){return this.uid},Object.defineProperty(t.prototype,"mName",{get:function(){return this._mName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yName",{get:function(){return this._yName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),t.prototype.getCurrentGame=function(){return this.game},t.prototype.initListen=function(){var t=this;this._socket.on("disconnect",function(){Game.Instance.gameOver(),MsgManager.Instance.showMessage("与服务器断开连接",30),t._active=!1,console.log("client disconnect")}),this._socket.on("connect_error",function(e){t._active&&(MsgManager.Instance.showMessage("连接服务器失败",30),t._active=!1,console.log(e))}),this._socket.on("user:loginSuccess",function(e){t.uid=e.uid,t._mName=e.username,console.log("login success")}),this._socket.on("room:created",function(e){console.log("create room success"),t.game=Game.Instance,global.syn=e.ballDirection,t._yName=e.opponent,MsgManager.Instance.setText("找到比赛"),SoundManager.playSound(Assets.Sound.findmatch),t.game.clearUpdateList(),Laya.timer.once(2e3,t,function(){t.getReady()})}),this._socket.on("frame:update",function(e){t.game.pushUpdateData(e)}),this._socket.on("game:start",function(e){MsgManager.Instance.removeMessage(function(){t.game.initScene(),t.game.ballDirections=e.directions,t.game.ballDirectionFactor=e.id===t.uid?1:0;var i=t.game.getBallDirection();t.game.initBall(t.game.ballDirectionFactor?i:1-i),Main.Instance.removeBackground(),Main.Instance.gamePage.addChild(Game.Instance.getCounter(function(){t.game.status=1,t.game.initControl(),t.game.startLoop()}))})}),this._socket.on("game:scorein",function(e){var i=e.scores;e.id===t.uid?ScoreManager.Instance.setScores("mine",{explosions:i.explosions,balls:i.balls,score:i.score}):ScoreManager.Instance.setScores("your",{explosions:i.explosions,balls:i.balls,score:i.score})}),this._socket.on("game:scores",function(e){e.msg?(Game.Instance.gameOver(),MsgManager.Instance.showMessage(e.msg,28,function(){Laya.timer.once(800,t,function(){MsgManager.Instance.removeMessage(),ScoreManager.Instance.showGameResult(e)})}),console.log("opponent leave room.")):(Game.Instance.gameOver(),Game.Instance.timer.isTimeout()?MsgManager.Instance.showMessage("时间到，比赛结束",30,function(){Laya.timer.once(1e3,t,function(){MsgManager.Instance.removeMessage(function(){ScoreManager.Instance.showGameResult(e)})})}):ScoreManager.Instance.showGameResult(e))}),this._socket.on("game:error",function(t){console.log(t.msg)}),this._socket.on("sys:msg",function(t){console.log("system message: "+t.msg)}),this._socket.on("connect_timeout",function(){console.log("connect timeout")}),this._socket.on("reconnect",function(){console.log("client reconnect")}),this._socket.on("connect",function(){console.log("client connected")})},t.prototype.login=function(t){this._socket.emit("user:login",{name:t})},t.prototype.match=function(){this._socket.emit("room:match")},t.prototype.getReady=function(){this._socket.emit("user:ready")},t.prototype.sendCtrl=function(t){this._socket.emit("user:ctrl",{id:this.uid,ctrl:t})},t.prototype.causeExplosion=function(){this._socket.emit("game:scorein",{id:this.uid,type:"bulletExplosion"})},t.prototype.ballIn=function(){this._socket.emit("game:scorein",{id:this.uid,type:"ballin"})},t.prototype.leaveRoom=function(){this._socket.emit("room:leave")},t}(),StartPage=function(t){function e(){t.call(this),this.name=DisplayName.StartPage,this.zOrder=DisplayOrder.StartPage,this.pos(global.leftEdge,0),this.btnMatch.on(LayaEvent.CLICK,this,this.onBtnMatch),this.btnJoinRoom.on(LayaEvent.CLICK,this,this.onBtnJoinRoom),this.btnCreateRoom.on(LayaEvent.CLICK,this,this.onBtnCreateRoom)}return __extends(e,t),e.prototype.onBtnMatch=function(){var t=this;SoundManager.playSound(Assets.Sound.button_001),Tween.to(this,{alpha:0},200,null,Handler.create(this,function(){t.remove(),t.alpha=1,MsgManager.Instance.showMessage("寻找比赛中"),MsgManager.Instance.showTips("胜利条件\n(1).进球数达到10个\n(2).最终分数更高"),Socket.Instance.match()}))},e.prototype.onBtnJoinRoom=function(){SoundManager.playSound(Assets.Sound.button_001),alert("房间功能尚未上线")},e.prototype.onBtnCreateRoom=function(){SoundManager.playSound(Assets.Sound.button_001),alert("房间功能尚未上线")},e.prototype.remove=function(){this.removeSelf()},e.prototype.disableBtn=function(){this.btnMatch.offAll()},e}(ui.startUI),Utils;!function(t){function e(){var t=new LayaText;t.name=DisplayName.Loading,t.color="#FFFFFF",t.font="Impact",t.fontSize=50,t.text="finding match......",t.x=Laya.stage.width/2-t.width/2,t.y=Laya.stage.height/2-t.height/2,Laya.stage.addChild(t)}function i(t,e){var i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i<=(t.width+e.width)/2&&s<=(t.height+e.height)/2}function s(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<=t.radius+e.radius}function o(e,i,s,o,n){void 0===n&&(n=!1),n&&(e.x=t.floatN(config.gameWidth-e.x),e.y=t.floatN(config.gameHeight-e.y),i.x=t.floatN(config.gameWidth-i.x),i.y=t.floatN(config.gameHeight-i.y),s.vx*=-1,s.vy*=-1,o.vx*=-1,o.vy*=-1);var a=t.pLength(e,i),r=0===a?0:((s.vx-o.vx)*Math.pow(e.x-i.x,2)+(s.vy-o.vy)*(e.x-i.x)*(e.y-i.y))/Math.pow(a,2),l=0===a?0:((s.vy-o.vy)*Math.pow(e.y-i.y,2)+(s.vx-o.vx)*(e.x-i.x)*(e.y-i.y))/Math.pow(a,2),h=t.floatN(s.vx-r),c=t.floatN(s.vy-l),u=t.floatN(o.vx+r),g=t.floatN(o.vy+l);return n&&(h*=-1,c*=-1,u*=-1,g*=-1),[h,c,u,g]}function n(e,i,s,o,n){void 0===n&&(n=!1),n&&(e.x=t.floatN(config.gameWidth-e.x),e.y=t.floatN(config.gameHeight-e.y),i.x=t.floatN(config.gameWidth-i.x),i.y=t.floatN(config.gameHeight-i.y));var a=t.pLength(e,i),r=(s+o-a)/2,l=0===a?0:r*(e.x-i.x)/a,h=0===a?0:r*(e.y-i.y)/a,c=t.floatN(e.x+l),u=t.floatN(e.y+h),g=t.floatN(i.x-l),p=t.floatN(i.y-h);return n&&(c=t.floatN(config.gameWidth-c),u=t.floatN(config.gameHeight-u),g=t.floatN(config.gameWidth-g),p=t.floatN(config.gameHeight-p)),[c,u,g,p]}function a(t){var e,i;return t>180?(e=360*Math.floor((t+180)/360),i=t-e):t<-180?(e=360*Math.floor((180-t)/360),i=t+e):i=t,i}function r(t,e,i,s,o,n){var a,r,l;a=n,r=o*-1,l=s*o-i*n;var h=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)),c=t*a+e*r+l;return Math.round(Math.abs(c/h))}function l(t,e,i,s,o,n){var a,r,l,h;return a=n,r=o*-1,l=s*o-i*n,h=a*t+r*e+l,h<0?1:h>0?-1:0}function h(t,e){return{x:t,y:e}}function c(t,e){void 0===e&&(e=6);for(var i=1,s=0;s<e;s++)i*=10;return Math.round(t*i)/i}function u(t){return parseInt(t+"")}function g(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function p(e,i,s){var o,n,a,r,l,h,c,u,g;return n=(e.y-i.y)/(e.x-i.x),o=Math.pow(n,2),a=o+1,r=-2*i.x*a,l=Math.pow(i.x,2)*a-Math.pow(s,2),h=(-1*r+Math.sqrt(r*r-4*a*l))/(2*a),u=(-1*r-Math.sqrt(r*r-4*a*l))/(2*a),c=n*h-n*i.x+i.y,g=n*u-n*i.x+i.y,e.x===i.x&&(h=i.x,u=i.x,c=i.y+s,g=i.y-s),Math.abs(e.x-h)<Math.abs(e.x-u)||Math.abs(e.y-c)<Math.abs(e.y-g)?t.p(h,c):t.p(u,g)}t.showLoading=e,t.isRectangleCollision=i,t.isCircleCollision=s,t.compBallRebound=o,t.fixCollision=n,t.standardAngle=a,t.distanceToLine=r,t.posToLine=l,t.p=h,t.floatN=c,t.toInt=u,t.pLength=g,t.crossingPointLC=p}(Utils||(Utils={}));var Animation=laya.display.Animation,Rectangle=laya.maths.Rectangle,BitmapFont=laya.display.BitmapFont,Tween=laya.utils.Tween,Ease=laya.utils.Ease,WebGL=laya.webgl.WebGL,Sprite=laya.display.Sprite,Handler=laya.utils.Handler,Loader=laya.net.Loader,Texture=laya.resource.Texture,LayaText=laya.display.Text,LayaEvent=laya.events.Event,Pool=laya.utils.Pool,ColorFilter=Laya.ColorFilter,SoundManager=Laya.SoundManager,Main=function(){function t(){this.assets=[];for(var t=Object.keys(Assets.Img),e=Object.keys(Assets.Json),i=Object.keys(Assets.Sound),s=0;s<i.length;s++)this.assets.push({url:Assets.Sound[i[s]],type:Loader.SOUND});for(var o=0;o<t.length;o++)this.assets.push({url:Assets.Img[t[o]],type:Loader.IMAGE});for(var s=0;s<e.length;s++)this.assets.push({url:Assets.Json[e[s]],type:Loader.ATLAS});this.initLaya(),this._loading=new Loading,
Laya.stage.on(LayaEvent.RESIZE,this,this.onStageResize),Laya.loader.load(this.assets,Handler.create(this,this.onLoaded),Handler.create(this,this.onLoading,null,!1),Loader.TEXT)}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamePage",{get:function(){return this._gamePage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startPage",{get:function(){return this._startPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bg",{get:function(){return this._bg},enumerable:!0,configurable:!0}),t.prototype.onLoaded=function(){var t=this;this._loading.hide(),this.initSocket(),this._bitmapfont=new BitmapFont,this._bitmapfont.loadFont(Assets.font.num,Handler.create(this,function(){LayaText.registerBitmapFont("diyfont",t._bitmapfont)})),this._gamePage=new Sprite,this._gamePage.name=DisplayName.GamePage,this._gamePage.zOrder=DisplayOrder.GamePage,this._gamePage.pivot(config.gameWidth/2,config.gameHeight/2),this._gamePage.pos(global.leftEdge+config.gameWidth/2,config.gameHeight/2),this._startPage=new StartPage,this.showBackground(),global.leftEdge=(Laya.stage.width-config.gameWidth)/2,global.rightEdge=(Laya.stage.width+config.gameWidth)/2,Laya.stage.addChild(this._gamePage),Laya.stage.addChild(this._startPage)},t.prototype.onLoading=function(t){this._loading.setProcess(t)},t.prototype.showBackground=function(){this._bg=new Sprite,this._bg.loadImage(Assets.Img.startBg),this._bg.pivot(640,400),this._bg.zOrder=DisplayOrder.Background,this._bg.pos(Laya.stage.width/2,Laya.stage.height/2),Laya.stage.addChild(this._bg)},t.prototype.removeBackground=function(){var t=this;this._bg.zOrder=DisplayOrder.Background_H,Tween.to(this._bg,{alpha:0},1e3,null,Handler.create(this,function(){Laya.stage.removeChild(t._bg),t._bg.alpha=1,t._bg.zOrder=DisplayOrder.Background}))},t.prototype.onStageResize=function(){global.leftEdge=(Laya.stage.width-config.gameWidth)/2,global.rightEdge=(Laya.stage.width+config.gameWidth)/2,this.repos()},t.prototype.initLaya=function(){Laya.init(config.gameWidth,config.gameHeight,WebGL),Laya.stage.scaleMode="fixedheight",Laya.stage.alignH="center",Laya.stage.alignV="middle",Laya.stage.bgColor="#000000"},t.prototype.initSocket=function(){var t=Socket.Instance;t.initListen(),t.login("user"+Math.round(1e3*Math.random()))},t.prototype.backToMenu=function(){var t=this;MsgManager.Instance.removeMessage(),ScoreManager.Instance.removeResultView(),Laya.stage.addChild(this._bg),Laya.stage.addChild(this.startPage),Tween.to(this.gamePage,{y:-800,alpha:0},800,null,Handler.create(this,function(){t.gamePage.alpha=1,t.gamePage.y=config.gameHeight/2,t.gamePage.removeChildren()}))},t.prototype.repos=function(){var t=MsgManager.Instance.msg,e=MsgManager.Instance.tipsText,i=Game.Instance.bulletProcess,s=Game.Instance.timer,o=Game.Instance.toolTagContainer,n=Game.Instance.btnSwitch,a=ScoreManager.Instance.myScorePanel,r=ScoreManager.Instance.yourScorePanel,l=ScoreManager.Instance.resultView;this._startPage&&this._startPage.pos(global.leftEdge,0),this._gamePage&&this._gamePage.pos(global.leftEdge+config.gameWidth/2,config.gameHeight/2),this._bg&&this._bg.pos(Laya.stage.width/2,Laya.stage.height/2),t&&t.pos(Laya.stage.width/2,Laya.stage.height/2),e&&e.pos(Laya.stage.width/2,Laya.stage.height-100),i&&i.repos(),s&&s.repos(),o&&o.repos(),n&&n.repos(),a&&a.repos(),r&&r.repos(),l&&l.repos()},t}();Main.Instance;var PProcessAttr={width:34,height:8},PProcess=function(t){function e(){t.call(this),this._status=0,this.loadImage(Assets.Img.pprocessbg),this.size(PProcessAttr.width,PProcessAttr.height),this.pivot(PProcessAttr.width/2,PProcessAttr.height/2),this.zOrder=DisplayOrder.PProcess,this.repos(),this.pmask=new Sprite,this.pmask.loadImage(Assets.Img.pprocess),this.pmask.size(PProcessAttr.width,PProcessAttr.height),this.pmask.pos(-1*PProcessAttr.width,0),this.process=new Sprite,this.process.loadImage(Assets.Img.pprocess),this.process.size(PProcessAttr.width,PProcessAttr.height),this.process.mask=this.pmask,this.percent=0,this.addChild(this.process),Main.Instance.gamePage.addChild(this)}return __extends(e,t),e.prototype.update=function(){this._status&&this.runProcess()},e.prototype.runProcess=function(){this.percent+=.03,this.percent>1&&(this.percent=1),this.pmask.pos(-1*PProcessAttr.width*(1-this.percent),0)},e.prototype.reduceProcess=function(){this.percent-=.05,this.percent<0&&(this.percent=0),this.pmask.pos(-1*PProcessAttr.width*(1-this.percent),0)},e.prototype.clearProcess=function(){this.percent=0,this.pmask.pos(-1*PProcessAttr.width*(1-this.percent),0)},e.prototype.start=function(){this._status=1},e.prototype.stop=function(){this._status=0,this.clearProcess()},e.prototype.repos=function(){this.pos(config.gameWidth/2,config.gameHeight-10)},e.prototype.remove=function(){this.removeSelf()},e}(laya.display.Sprite),TiledMap;!function(t){var e=laya.map.TiledMap,i=laya.display.Sprite,s=laya.maths.Rectangle,o=laya.utils.Browser,n=laya.utils.Handler,a=laya.maths.Point,r=function(){function t(){this.mLastMouseX=0,this.mLastMouseY=0,this.mX=0,this.mY=0,this.tiledMap=new e,this.mX=this.mY=0,this.tiledMap.createMap("res/tiledMap/isometric_grass_and_water.json",new s(0,0,Laya.stage.width,Laya.stage.height),n.create(this,this.mapLoaded),null,new a(1600,800)),Laya.stage.on("click",this,this.onStageClick)}return t.prototype.resize=function(){this.tiledMap.changeViewPort(this.mX,this.mY,o.width,o.height)},t.prototype.mouseDown=function(){this.mLastMouseX=Laya.stage.mouseX,this.mLastMouseY=Laya.stage.mouseY,Laya.stage.on(laya.events.Event.MOUSE_MOVE,this,this.mouseMove)},t.prototype.mouseMove=function(){this.tiledMap.moveViewPort(this.mX-(Laya.stage.mouseX-this.mLastMouseX),this.mY-(Laya.stage.mouseY-this.mLastMouseY))},t.prototype.mouseUp=function(){this.mX=this.mX-(Laya.stage.mouseX-this.mLastMouseX),this.mY=this.mY-(Laya.stage.mouseY-this.mLastMouseY),Laya.stage.off(laya.events.Event.MOUSE_MOVE,this,this.mouseMove)},t.prototype.completeHandler=function(){console.log("地图创建完成"),console.log("ClientW:"+o.clientWidth+" ClientH:"+o.clientHeight),Laya.stage.on(laya.events.Event.RESIZE,this,this.resize),this.resize()},t.prototype.mapLoaded=function(){this.layer=this.tiledMap.getLayerByIndex(0);var t=32*Math.tan(180/Math.PI*30);this.sprite=new i,this.sprite.graphics.drawLine(0,0,-32,t,"cyan"),this.sprite.graphics.drawLine(0,0,32,t,"cyan"),this.sprite.graphics.drawLine(-32,t,0,2*t,"cyan"),this.sprite.graphics.drawLine(32,t,0,2*t,"cyan"),Laya.stage.addChild(this.sprite)},t.prototype.onStageClick=function(){var t=new a(0,0);this.layer.getTilePositionByScreenPos(Laya.stage.mouseX,Laya.stage.mouseY,t),this.layer.getScreenPositionByTilePos(Math.floor(t.x),Math.floor(t.y),t),this.sprite.pos(t.x,t.y)},t}();t.TiledMapManager=r}(TiledMap||(TiledMap={}));